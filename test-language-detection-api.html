<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language Detection API Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-left: 4px solid #2196F3;
            border-radius: 4px;
        }
        .test-section h2 {
            margin-top: 0;
            color: #2196F3;
        }
        textarea {
            width: 100%;
            min-height: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
            margin: 10px 0;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .success {
            border-left: 4px solid #4CAF50;
            background: #f1f8f4;
        }
        .error {
            border-left: 4px solid #f44336;
            background: #fef1f0;
        }
        .info {
            border-left: 4px solid #2196F3;
            background: #e3f2fd;
        }
        .language-result {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
        .confidence-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .all-results {
            margin-top: 15px;
        }
        .result-item {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .result-bar {
            flex: 1;
            margin-left: 15px;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }
        .result-bar-fill {
            height: 100%;
            background: #2196F3;
        }
        pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .status.checking {
            background: #fff3cd;
            color: #856404;
        }
        .status.available {
            background: #d4edda;
            color: #155724;
        }
        .status.unavailable {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåç Chrome Language Detection API Test</h1>
        
        <div class="test-section">
            <h2>1. API Availability Check</h2>
            <button onclick="checkAPIAvailability()">Check API Availability</button>
            <div id="availability-result"></div>
        </div>

        <div class="test-section">
            <h2>2. Test Language Detection</h2>
            <p>Enter text to detect its language:</p>
            <textarea id="test-text" placeholder="Enter text here...">Example Domains As described in RFC 2606 and RFC 6761, a number of domains such as example.com and example.org are maintained for documentation purposes. These domains may be used as illustrative examples in documents without prior coordination with us. They are not available for registration or transfer.</textarea>
            <br>
            <button onclick="detectLanguage()">Detect Language</button>
            <button onclick="loadSampleText('en')">Load English Sample</button>
            <button onclick="loadSampleText('es')">Load Spanish Sample</button>
            <button onclick="loadSampleText('fr')">Load French Sample</button>
            <button onclick="loadSampleText('de')">Load German Sample</button>
            <div id="detection-result"></div>
        </div>

        <div class="test-section">
            <h2>3. Console Logs</h2>
            <p>Open DevTools Console (F12) to see detailed logs</p>
        </div>
    </div>

    <script>
        // Sample texts in different languages
        const sampleTexts = {
            en: "Example Domains As described in RFC 2606 and RFC 6761, a number of domains such as example.com and example.org are maintained for documentation purposes. These domains may be used as illustrative examples in documents without prior coordination with us. They are not available for registration or transfer.",
            es: "Los dominios de ejemplo Como se describe en RFC 2606 y RFC 6761, varios dominios como example.com y example.org se mantienen con fines de documentaci√≥n. Estos dominios pueden usarse como ejemplos ilustrativos en documentos sin coordinaci√≥n previa con nosotros.",
            fr: "Domaines d'exemple Comme d√©crit dans RFC 2606 et RFC 6761, plusieurs domaines tels que example.com et example.org sont maintenus √† des fins de documentation. Ces domaines peuvent √™tre utilis√©s comme exemples illustratifs dans des documents sans coordination pr√©alable avec nous.",
            de: "Beispieldom√§nen Wie in RFC 2606 und RFC 6761 beschrieben, werden mehrere Dom√§nen wie example.com und example.org zu Dokumentationszwecken gepflegt. Diese Dom√§nen k√∂nnen als anschauliche Beispiele in Dokumenten ohne vorherige Abstimmung mit uns verwendet werden."
        };

        function loadSampleText(lang) {
            document.getElementById('test-text').value = sampleTexts[lang];
        }

        async function checkAPIAvailability() {
            const resultDiv = document.getElementById('availability-result');
            resultDiv.innerHTML = '<div class="status checking">‚è≥ Checking API availability...</div>';
            
            console.log('=== API Availability Check ===');
            console.log('typeof LanguageDetector:', typeof LanguageDetector);
            console.log('typeof window.ai:', typeof window.ai);
            
            const checks = {
                'LanguageDetector (Global API)': typeof LanguageDetector !== 'undefined',
                'window.ai': typeof window.ai !== 'undefined',
                'window.ai.languageModel': typeof window.ai?.languageModel !== 'undefined',
                'window.ai.summarizer': typeof window.ai?.summarizer !== 'undefined',
                'window.ai.rewriter': typeof window.ai?.rewriter !== 'undefined',
                'Translator (Global API)': typeof Translator !== 'undefined'
            };

            let html = '<div class="result info"><h3>API Availability:</h3>';
            for (const [api, available] of Object.entries(checks)) {
                const icon = available ? '‚úÖ' : '‚ùå';
                const status = available ? 'Available' : 'Not Available';
                html += `<div>${icon} <strong>${api}:</strong> ${status}</div>`;
            }
            html += '</div>';

            if (checks['LanguageDetector (Global API)']) {
                html += '<div class="status available">‚úÖ Language Detection API is available!</div>';
                html += '<p>You can now test language detection below.</p>';
            } else {
                html += '<div class="status unavailable">‚ùå Language Detection API is NOT available</div>';
                html += '<div class="result error">';
                html += '<h4>Possible reasons:</h4>';
                html += '<ul>';
                html += '<li>Chrome version is too old (need Chrome 128+)</li>';
                html += '<li>Chrome flags not enabled (check chrome://flags/)</li>';
                html += '<li>API not available in your region</li>';
                html += '<li>Running in incompatible context (e.g., service worker)</li>';
                html += '</ul>';
                html += '<h4>How to enable:</h4>';
                html += '<ol>';
                html += '<li>Go to <code>chrome://flags/</code></li>';
                html += '<li>Search for "AI" or "Gemini"</li>';
                html += '<li>Enable relevant flags</li>';
                html += '<li>Restart Chrome</li>';
                html += '</ol>';
                html += '</div>';
            }

            resultDiv.innerHTML = html;
        }

        async function detectLanguage() {
            const text = document.getElementById('test-text').value;
            const resultDiv = document.getElementById('detection-result');

            if (!text.trim()) {
                resultDiv.innerHTML = '<div class="result error">‚ùå Please enter some text to detect</div>';
                return;
            }

            resultDiv.innerHTML = '<div class="status checking">‚è≥ Detecting language...</div>';

            console.log('=== Language Detection Test ===');
            console.log('Text length:', text.length);
            console.log('Text preview:', text.substring(0, 100) + '...');

            try {
                // Check if API is available
                if (typeof LanguageDetector === 'undefined') {
                    throw new Error('LanguageDetector API is not available. Please check API availability first.');
                }

                console.log('‚úÖ LanguageDetector API is available');
                console.log('Creating detector instance...');

                // Create detector
                const detector = await LanguageDetector.create();
                console.log('‚úÖ Detector instance created');

                console.log('Calling detector.detect()...');
                const startTime = performance.now();
                const results = await detector.detect(text);
                const endTime = performance.now();
                const duration = (endTime - startTime).toFixed(2);

                console.log('‚úÖ Detection complete in', duration, 'ms');
                console.log('Raw results:', results);

                if (!results || results.length === 0) {
                    throw new Error('No language detected');
                }

                // Sort by confidence
                const sortedResults = [...results].sort((a, b) => b.confidence - a.confidence);
                const topResult = sortedResults[0];

                console.log('Top result:', topResult);

                // Display results
                let html = '<div class="result success">';
                html += '<h3>‚úÖ Detection Successful!</h3>';
                html += `<div class="language-result">Language: ${topResult.detectedLanguage.toUpperCase()}</div>`;
                html += `<div>Confidence: ${(topResult.confidence * 100).toFixed(2)}%</div>`;
                html += '<div class="confidence-bar">';
                html += `<div class="confidence-fill" style="width: ${topResult.confidence * 100}%">${(topResult.confidence * 100).toFixed(1)}%</div>`;
                html += '</div>';
                html += `<div style="color: #666; font-size: 14px;">Detection time: ${duration}ms</div>`;

                // Show all results
                if (sortedResults.length > 1) {
                    html += '<div class="all-results"><h4>All detected languages:</h4>';
                    sortedResults.forEach((result, index) => {
                        html += '<div class="result-item">';
                        html += `<span><strong>${index + 1}. ${result.detectedLanguage.toUpperCase()}</strong> - ${(result.confidence * 100).toFixed(2)}%</span>`;
                        html += '<div class="result-bar">';
                        html += `<div class="result-bar-fill" style="width: ${result.confidence * 100}%"></div>`;
                        html += '</div>';
                        html += '</div>';
                    });
                    html += '</div>';
                }

                html += '<h4>Raw API Response:</h4>';
                html += `<pre>${JSON.stringify(results, null, 2)}</pre>`;
                html += '</div>';

                resultDiv.innerHTML = html;

            } catch (error) {
                console.error('‚ùå Detection failed:', error);
                
                let html = '<div class="result error">';
                html += '<h3>‚ùå Detection Failed</h3>';
                html += `<p><strong>Error:</strong> ${error.message}</p>`;
                html += '<h4>Error Details:</h4>';
                html += `<pre>${JSON.stringify({
                    name: error.name,
                    message: error.message,
                    stack: error.stack
                }, null, 2)}</pre>`;
                html += '</div>';

                resultDiv.innerHTML = html;
            }
        }

        // Auto-check API availability on load
        window.addEventListener('load', () => {
            console.log('üåç Language Detection API Test Page Loaded');
            console.log('Click "Check API Availability" to start');
            checkAPIAvailability();
        });
    </script>
</body>
</html>
